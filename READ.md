# 프로젝트 회고록

## 프로젝트 개요

e-커머스 서비스 프로젝트는 전자상거래를 위한 플랫폼입니다.
주문, 결제, 상품 관리, 판매량 집계와 같은 핵심 기능을 구현했습니다.
이번 프로젝트를 통해 기본적인 전자상거래 시스템 설계부터 동시성 문제 해결까지 다양한 주제를 다뤄볼 수 있었습니다.

---

## 주요 개발 사항

### 1) **도메인 설계**

- **주문/결제/상품 판매량 통계 도메인**을 설계하여 명확한 책임 분리를 달성.
- 상품 일별 판매량(ProductDailySales) 통계 기록 및 조회 기능을 통해 비즈니스 요구사항 충족.
- **잔액 관리 도메인 설계**:
    - 사용자 잔액 충전, 차감, 잔액 조회 API를 추가.
    - 최소/최대 충전 금액, 최대 잔액 제약조건을 고려한 로직 구현.
    - 잔액 부족 시 예외 처리 설계.

### 2) **테스트 주도 개발**

- 단위 테스트를 기반으로 주요 서비스(주문, 결제, 판매량 업데이트 등)를 검증.
- Mock 객체를 활용한 독립적인 테스트 환경 구성.
- 동시성 테스트를 통해 데이터 일관성 및 안정성 검증 시도.

### 3) **API 설계 및 구현**

- 주문 생성 및 결제 API를 통해 사용자가 직접 시나리오를 수행할 수 있도록 구현.
- 동시성 문제를 고려한 로직 작성 및 테스트 진행.

### 4) **기술 스택**

- **Spring Boot**: 애플리케이션 전반의 프레임워크.
- **JPA**: 데이터베이스와의 상호작용 및 동시성 처리.
- **JUnit/Mockito**: 테스트 코드 작성 및 유닛 테스트 수행.

---

## 성공한 점

### 1. 모듈화된 설계

- **도메인 분리**: 결제와 판매량 집계를 독립적인 도메인으로 설계해 유지보수성을 높였습니다.
- **서비스 계층의 역할 분리**: PaymentService와 ProductDailySalesService와 같은 서비스를 통해 단일 책임 원칙(SRP)을 준수했습니다.

### 2. 테스트 코드 작성

- Mock을 적극적으로 활용해 다양한 시나리오를 테스트.
- 특히, 결제 완료 시 상품 판매량이 제대로 반영되는지 검증.

### 3. 실시간 데이터 반영

- 결제 완료 시, 상품 일별 판매량이 즉시 업데이트되도록 로직을 구현해 데이터 일관성을 유지했습니다.

---

## 어려웠던 점과 한계

### 1. **동시성 문제 해결의 한계**

- **비관적 락**: `LockModeType.PESSIMISTIC_WRITE`를 사용했지만 데드락 발생으로 테스트 성공률이 100%에 미치지 못함.
- **낙관적 락**: `@Version`을 도입했지만, `Could not open JPA EntityManager for transaction` 오류로 인해 적용에 실패.
- **분산 락 고민**: 위 문제를 완전히 해결하지 못해 Redis 기반 분산 락과 같은 외부 솔루션 도입을 고려하게 됨.
- **반성**: 락과 트랜잭션의 조합 및 적용 방식에 대한 학습이 부족했음을 느꼈으며, 더 많은 테스트와 학습이 필요.

### 2. **테스트에서의 예상치 못한 문제**

- Mock 데이터 설정에서 실수로 인한 테스트 실패.
- 예를 들어, 서비스 계층에서 예상하지 못한 매개변수 전달로 인해 테스트가 실패한 사례 발생.

### 3. **판매량 통계 로직**

- **문제점**:
    - 최근 3일간의 판매량 상위 5개 상품을 조회하는 로직에서 성능 최적화 부족.
    - 대규모 데이터에서의 효율적인 집계 쿼리 설계 미흡.
- **해결 방안**:
    1. 날짜 범위 필터와 정렬 조건을 최적화한 쿼리 작성.
    2. 인덱스 최적화와 캐싱 전략 적용 검토.
    3. 통계 쿼리의 단위 테스트를 통해 정확성 검증.

---

## 개선 방향

### 1. **동시성 문제에 대한 학습 강화**

- 락과 트랜잭션에 대한 학습과 개선이 필요한 점을 깨달음.
- 동시성 테스트의 성공률이 100%에 도달하지 못했으며, 분산 락 적용 필요성을 확인.

### 2. **프로젝트 관리 개선점**

- 초기 설계 단계에서 도메인의 완전성을 더 철저히 검토할 필요.
- 구현 후반부에서 발견된 요구사항들을 설계 단계에서 미리 예측할 수 있도록 비즈니스 요구사항 분석 능력을 강화.

### 3. **코드 리팩토링**

- 중복 코드 제거 및 가독성 향상을 위한 코드 정리.
- 도메인 이벤트 패턴을 도입해 결제와 판매량 반영 간의 느슨한 결합 추구.
- 잔액 충전 및 차감 로직에 대한 유효성 검증 로직 강화.

### 4. **개인적인 학습 목표**

- 동시성 처리와 락 메커니즘에 대한 이해를 깊게 하고, 문제를 해결할 수 있는 다양한 접근 방식을 습득.
- 복잡한 도메인 간의 연계를 단순화하는 설계 패턴 학습.

---

## 느낀점

이번 프로젝트는 도전과 배움의 연속이었습니다.
설계, 구현, 테스트 전반에 걸쳐 많은 경험을 쌓을 수 있었고, 특히 동시성 문제와 도메인 설계의 중요성을 깊이 깨달았습니다.
이번 경험을 바탕으로 더 나은 시스템을 설계하고, 안정적인 서비스를 제공하기 위한 역량을 강화할 것입니다.